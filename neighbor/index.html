
<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="UTF-8" />
<title>Neighbor21 Test</title>
<meta name="viewport" content="width=768, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="format-detection" content="telephone=no">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Micro+5&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./static/themes/reset.css">
<link rel="stylesheet" href="./static/themes/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
  <picture class="background">
    <img src="./public/static/themes/img/universe.jpeg" alt="">
  </picture>

  <main class="contents">
    <picture class="magiccircle">
      <img src="./public//static/themes/img/magiccircle.png" alt="">
    </picture>
      <div id="visual" class="visual">
      </div>

      <div class="carousel-btns">
        <button class="btn btn-prv"></button>
        <button class="btn btn-next"></button>
        <button class="btn play"></button>
      </div>

    <div class="carousel">
      <div class="carousel-track">
  
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img robot">
                <img src="./public/static/themes/img/robot.webp" alt="">
              </picture>
          </div>
        </div>
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img white">
                <img src="./public/static/themes/img/white.webp" alt="">
              </picture>
          </div>
        </div>
        <!-- <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img robot">
                <img src="./public/static/themes/img/robot.webp" alt="">
              </picture>
          </div>
        </div> -->
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img knight">
                <img src="./public/static/themes/img/knight.webp" alt="">
              </picture>
          </div>
        </div>
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img greenknight">
                <img src="./public/static/themes/img/greenknight.webp" alt="">
              </picture>
          </div>
        </div>
        <!-- <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img robot">
                <img src="./public/static/themes/img/robot.webp" alt="">
              </picture>
          </div>
        </div> -->
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img redknight">
                <img src="./public/static/themes/img/redknight.webp" alt="">
              </picture>
          </div>
        </div>
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img blackrobot">
                <img src="./public/static/themes/img/blackrobot.webp" alt="">
              </picture>
          </div>
        </div>
        <!-- <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img robot">
                <img src="./public/static/themes/img/robot.webp" alt="">
              </picture>
          </div>
        </div>
        <div class="crousel-slide">
          <div class="slide-content">
              <picture class="img knight">
                <img src="./public/static/themes/img/knight.webp" alt="">
              </picture>
          </div>
        </div> -->
        
      </div>
    </div>

    <div class="svg-line-wrap">
      <div class="svg-line left">
        <svg width="516" height="77" viewBox="0 0 516 77" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 1C0 1 407.106 1 440.5 1C473.894 1 467 2.99999 514.5 75.5" stroke="url(#paint0_linear_2_4)" stroke-width="2"/>
        <defs>
        <linearGradient id="paint0_linear_2_4" x1="0" y1="44" x2="547" y2="44" gradientUnits="userSpaceOnUse">
        <stop stop-color="#3DF3FF"/>
        <stop offset="0.325" stop-color="#2A70FF"/>
        <stop offset="0.66" stop-color="#D21DFF"/>
        <stop offset="1" stop-color="#16FFE3"/>
        </linearGradient>
        </defs>
        </svg>
      </div>
      <div class="svg-line right">
        <svg width="516" height="77" viewBox="0 0 516 77" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 1C0 1 407.106 1 440.5 1C473.894 1 467 2.99999 514.5 75.5" stroke="url(#paint0_linear_2_4)" stroke-width="2"/>
        <defs>
        <linearGradient id="paint0_linear_2_4" x1="0" y1="44" x2="547" y2="44" gradientUnits="userSpaceOnUse">
        <stop stop-color="#3DF3FF"/>
        <stop offset="0.325" stop-color="#2A70FF"/>
        <stop offset="0.66" stop-color="#D21DFF"/>
        <stop offset="1" stop-color="#16FFE3"/>
        </linearGradient>
        </defs>
        </svg>
      </div>
    </div>
    <div class="board">
      <div class="board-item left">
        <ul class="board-content">
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>우와막엄청세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>우와막엄청세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>우와막엄청세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>

          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
        </ul>
      </div>
      <div class="board-item right">
        <ul class="board-content">
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>

          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
          <li class="item">
            <div class="score">20</div>
            <div class="text">
              <strong>공격력</strong>
              <p>아주많이세요</p>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div class="count">
      <span class="current-index"></span>
      <span class="slides-length"></span>
    </div>
  </main>

  <div class="nothing"></div>

  <script type="module" src="static/js/script.js"></script>
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.1/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stats-js@1.0.1/build/stats.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.18.1/dist/lil-gui.umd.min.js"></script>
  <script type="module">
  import * as THREE from 'three';
  import * as BufferGeometryUtils from 'three/addons/utils/BufferGeometryUtils.js';
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
  import { MapControls } from 'three/addons/controls/MapControls.js';
  import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
  import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
  import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';

  import Carousel from './static/js/script'


  const slideInit = Carousel('.carousel', {
    speed: 0.7,
    delay: 'none',
    // conChangeActive: (data) => { console.log('슬라이드 가운데 위치 / 유저 정보 : ', data) },
  });



  window._DEBUG = location.search.indexOf('debug') > -1;
  window._DEBUG && document.documentElement.classList.add('_DEBUG');


  // 데이터 전송할 때 쓰는 건 가봄??
  // fetch('./sample-data.json')
  // 	.then((response) => response.json())
  // 	.then((data) => {
  // 		Monitor3d.init(
  // 			data,
  // 			(userInfo) => {
  // 				console.log('card click', userInfo);
  // 			},
  // 			(userInfo) => {
  // 				console.log('similarity click', userInfo);
  // 			},
  // 			(userInfo) => {
  // 				console.log('intimacy click', userInfo);
  // 			}
  // 		);
  // 	});

  //주변에 파티클 있었으면 좋겠음


  const Monitor3d = (() => {
    const PI = Math.PI;
    const PI2 = PI * 2;
    const PI_HALF = PI / 2;


    let data, onCardClick, onSimilarityClick, onIntimacyClick;

    let $visual;

    let areaWidth, areaHeight;

    let scene, camera, renderer, composer, bloomPass;
    let decoGroup, decoTimeline;

    const canvasSize = 1024;

    const degToRad = THREE.MathUtils.degToRad;

    let gui, stats, control;


    function init (_data, _onCardClick, _onSimilarityClick, _onIntimacyClick) {
      data = _data;
      onCardClick = _onCardClick;
      onSimilarityClick = _onSimilarityClick;
      onIntimacyClick = _onIntimacyClick;

      document.querySelector('.carousel').classList.add('active');

      if ($visual) {
        // reset data?
        return;
      }

      $visual = document.querySelector('#visual');

      onResize();

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(52, areaWidth / areaHeight, 1, 1000);
      camera.position.set(0, 2, 15);
      camera.lookAt(0,-1,0);
      camera.zoom = 1.6;

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      $visual.appendChild(renderer.domElement);

      if (window._DEBUG) {
        gui = new lil.GUI();
        gui.add(camera.position, 'z', 0, 50, 0.001).name('camera z');
        gui.add(camera, 'zoom', 0, 10, 0.001).name('camera zoom').onChange(() => camera.updateProjectionMatrix());

        stats = new Stats();
        document.body.appendChild(stats.dom);

        control = new OrbitControls(camera, renderer.domElement);
      }

      decoGroup = new THREE.Group();
      decoTimeline = gsap.timeline();


      // decoGroup.rotation.x = -PI_HALF; // 오브젝트 세우기~
      decoGroup.position.y = -0.3;
      scene.add(decoGroup);

      decoTimeline.fromTo(decoGroup.rotation, { x: degToRad(0), y: degToRad(0), }, { x: degToRad(-90), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );


      composer = new EffectComposer(renderer); //시각적 후처리 효과를 위해 사용하는 클래스
      composer.addPass(new RenderPass(scene, camera)); //씬과 카메라에 대한 렌더링이 이루어진 후 후처리 효과 적용

      //쉐이더.. 이거 클론 끝나면 쉐이더 봐야지
      const baseVertexShader = `
        varying vec2 v_uv;

        void main() {
          v_uv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `;

      bloomPass = new ShaderPass({
        uniforms: {
          tDiffuse: { value: null },
          u_threshold: { value: 0.1 },
          u_intensity: { value: 0.9 },
          u_blurSize: { value: 2.5 },
          u_resolution: { value: new THREE.Vector2() }
        },
        vertexShader: baseVertexShader,
        fragmentShader: `
          uniform sampler2D tDiffuse;
          uniform float u_threshold;
          uniform float u_intensity;
          uniform float u_blurSize;

          varying vec2 v_uv;

          // https://www.shadertoy.com/view/Ms2Xz3
          vec4 blurColor (vec2 st) {
            vec2 texelSize = u_blurSize / vec2(1328.0 * 2.0, 726.0 * 2.0);

            vec4 color = texture2D(tDiffuse, st, u_blurSize);
            color += texture2D(tDiffuse, st + vec2(texelSize.x, 0.0), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(-texelSize.x, 0.0), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(0.0, texelSize.y), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(0.0, -texelSize.y), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(texelSize.x, texelSize.y), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(-texelSize.x, texelSize.y), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(texelSize.x, -texelSize.y), u_blurSize);
            color += texture2D(tDiffuse, st + vec2(-texelSize.x, -texelSize.y), u_blurSize);

            return color / 8.0;
          }

          void main () {
            vec4 color = texture2D(tDiffuse, v_uv);
            vec4 highlight = clamp(blurColor(v_uv) - u_threshold, 0.0, 1.0) * 1.0 / (1.0 - u_threshold);

            gl_FragColor = 1.0 - (1.0 - color) * (1.0 - highlight * u_intensity);
          }
        `
      });
      // composer.addPass(bloomPass);

      if (window._DEBUG) {
        gui.add(bloomPass.uniforms.u_threshold, 'value', 0, 1, 0.001).name('bloom threshold');
        gui.add(bloomPass.uniforms.u_intensity, 'value', 0, 2, 0.001).name('bloom intensity');
        gui.add(bloomPass.uniforms.u_blurSize, 'value', 0, 5, 0.001).name('bloom blurSize');
      }

      composer.addPass(new ShaderPass({
        uniforms: {
          tDiffuse: { value: null }
        },
        vertexShader: baseVertexShader,
        fragmentShader: `
          #define PI ${ PI }
          #define PI_HALF ${ PI_HALF }

          uniform sampler2D tDiffuse;

          varying vec2 v_uv;

          float random (in vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
          }

          float easeOutExpo (float t) {
            return t == 1.0 ? t : 1.0 - pow(2.0, -10.0 * t);
          }

          float numsamples = 50.0;
          void main () {
            vec4 color = texture2D(tDiffuse, v_uv);

            vec2 tocenter = vec2(0.5, -1.0) - v_uv;

            for (float i = 0.0; i < numsamples; i++) {
              float lerp = (i + random(vec2(gl_FragCoord.xy))) / numsamples;

              // float weight = cos(lerp * PI_HALF);
              float weight = (1.0 - easeOutExpo(lerp)) * 4.5;
              vec4 sampled = texture2D(tDiffuse, v_uv + tocenter * lerp * 0.25);

              color += sampled * weight * 0.03;
            }

            gl_FragColor = color;
          }
        `
      }));


      createDecoPlanes();

      window.addEventListener('resize', onResize);
      onResize();

      gsap.ticker.add(animate);
    }

    function createDecoPlanes () {
      let plane;

      // □ □ □
      plane = createDecoPlane(7, () => {
        const { $canvas, context } = createCanvas();

        const innerRadius = canvasSize / 2 - canvasSize / 6;
        const eachAngle = 360 / 9;
        const arcAngle = degToRad(eachAngle - 11);
        const lineWidth = 5;

        context.lineWidth = lineWidth;
        const gradient = context.createLinearGradient(20, 80, 200, 150);
          gradient.addColorStop(0, 'red');
          gradient.addColorStop(0.25, 'yellow');
          gradient.addColorStop(0.5, 'red');
          gradient.addColorStop(0.75, 'yellow');
          gradient.addColorStop(1, 'red');


        // context.strokeStyle = 'rgba(255, 0, 0, 0.9)';
        context.strokeStyle = gradient;

        for (let i = 0; i < 9; i++) {
          context.translate(canvasSize / 2, canvasSize / 2); //현재 위치에서 이동
          context.rotate(degToRad(eachAngle));
          context.translate(-canvasSize / 2, -canvasSize / 2);
          context.beginPath();
          context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, 4, arcAngle); //원 그리는 데 arc() 메서드 잘 사용됨
          //x, y, radius, startAngle, endAngle [, anticlockwise]
          context.lineTo(
            canvasSize / 2 + Math.cos(arcAngle) * innerRadius,
            canvasSize / 2 + Math.sin(arcAngle) * innerRadius
          );
          context.arc(canvasSize / 2, canvasSize / 2, innerRadius - lineWidth / 2, arcAngle, 0, false);
          context.closePath();
          context.stroke();
          // context.fill();
        }
        
        return $canvas;
      });
      plane.position.z = -2.47;

      setDecoPlaneRotation(plane);
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(12), y: degToRad(10), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut' }, 0.1);
      decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0);
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );

      // □ □ □ - 2
      plane = createDecoPlane(3.5, () => {
        const { $canvas, context } = createCanvas();

        const innerRadius = canvasSize / 2 - canvasSize / 6;
        const eachAngle = 360 / 9;
        const arcAngle = degToRad(eachAngle - 11);
        const lineWidth = 2;

        context.lineWidth = lineWidth;
        // context.strokeStyle = 'rgba(0, 170, 255, 0.5)';
        // context.fillStyle = 'rgba(0, 170, 255, 0.1)';
        context.strokeStyle = 'rgba(255, 0, 0, 0.4)';
        context.fillStyle = 'rgba(255, 0, 0, 0.3)';

        for (let i = 0; i < 9; i++) {
          context.translate(canvasSize / 2, canvasSize / 2);
          context.rotate(degToRad(eachAngle));
          context.translate(-canvasSize / 2, -canvasSize / 2);
          context.beginPath();
          context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, 0, arcAngle);
          context.lineTo(
            canvasSize / 2 + Math.cos(arcAngle) * innerRadius,
            canvasSize / 2 + Math.sin(arcAngle) * innerRadius
          );
          context.arc(canvasSize / 2, canvasSize / 2, innerRadius - lineWidth / 2, arcAngle, 0, true);
          context.closePath();
          context.stroke();
          context.fill();
        }
        
        return $canvas;
      });
      plane.position.z = -2.6;

      setDecoPlaneRotation(plane);
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(12), y: degToRad(10), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut' }, 0.1);
      decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0);      
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );

      // ■ ■  ■
      [
        [40, 10, 30],
        [50, 10, 20],
        [25, 15, 25],
        [30, 5, 35],
        [20, 15, 30],
        [50, 10, 20],
        [30, 5, 35],
        [25, 15, 25]
      ].forEach((lineInfo, index) => {
        plane = createDecoPlane(7, () => {
          const { $canvas, context } = createCanvas();
          const lineWidth = canvasSize / 6;

          context.lineWidth = lineWidth;
          context.strokeStyle = 'rgba(255, 0, 0, 0.2)';

          for (let i = 0, lastAngle = 0; i < lineInfo.length; i++) {
            const angle = degToRad(lineInfo[i]);
            if (i % 2 === 0) {
              context.beginPath();
              context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, lastAngle, lastAngle + angle);
              context.stroke();
            }
            lastAngle += angle;
          }
          
          return $canvas;
        });
        plane.rotation.z = PI_HALF * index;
        plane.position.z = -2.5 + 0.001 * index;

        setDecoPlaneRotation(plane);
        decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0);
        // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );
      });

      // ||||||||
      plane = createDecoPlane(4.9, () => {
        const { $canvas, context } = createCanvas();

        const eachAngle = 360 / 160;
        const lineWidth = 8;

        context.lineWidth = lineWidth;
        context.strokeStyle = 'rgba(255, 0, 0, 0.8)';

        for (let i = 0; i < 160; i++) {
          context.translate(canvasSize / 2, canvasSize / 2);
          context.rotate(degToRad(eachAngle));
          context.translate(-canvasSize / 2, -canvasSize / 2);
          context.beginPath();
          context.moveTo(0, canvasSize / 2);
          context.lineTo(30, canvasSize / 2);
          context.stroke();
        }
        
        return $canvas;
      });
      plane.position.z = -2.25;

      decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0.08);
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );

      // -_-_-
      for (let i = 0; i < 3; i++) {
        const radius = 3.9 + 0.25 * i;
        plane = createDecoPlane(radius, () => {
          const { $canvas, context } = createCanvas();

          const lineWidth = 15;

          context.lineWidth = lineWidth;
          // context.strokeStyle = 'rgba(255, 0, 0, 0.7)';
          const gradient = context.createLinearGradient(10, 20, 170, 170);
          gradient.addColorStop(0, 'red');
          gradient.addColorStop(0.25, 'yellow');
          gradient.addColorStop(0.5, 'red');
          gradient.addColorStop(0.75, 'yellow');
          gradient.addColorStop(1, 'red');

          context.strokeStyle =gradient;

          for (let j = 0, lastAngle = 0; j < 999; j++) {
            const angle = degToRad(j % 2 === 0 ? Math.random() * 30 + 5 :  Math.random() * 5 + 2);
            if (j % 2 === 0) {
              context.beginPath();
              context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, lastAngle, lastAngle + angle);
              context.stroke();
            }
            lastAngle += angle;
            if (lastAngle > PI2) {
              break;
            }
          }
          
          return $canvas;
        });
        plane.rotation.z = PI_HALF * i;
        plane.position.z = -2.1;

        gsap.to(plane.rotation, { z: i % 2 === 0 ? -PI2 : PI2, duration: 15, ease: 'linear', repeat: -1 });
        decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0.15);
        // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );
      }


      // prime
      // plane = createDecoPlane(4.9, () => {
      //   const canvasSize = 512;
      //   const { $canvas, context } = createCanvas(canvasSize);

      //   const eachAngle = 720;
      //   const arcAngle = degToRad(eachAngle - 5);
      //   const lineWidth = 4;

      //   context.lineWidth = lineWidth;
      //   context.strokeStyle = 'rgba(255, 0, 0, 0.7)';

      //     context.beginPath();
      //     context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, 0, arcAngle);
      //     context.stroke();
        
      //   return $canvas;
      // });
      // plane.position.z = -1.9;

      setDecoPlaneRotation(plane, 1);
      // decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0.2);

      // top
      plane = createDecoPlane(3.1, () => {
        const canvasSize = 512;
        const { $canvas, context } = createCanvas(canvasSize);

        const eachAngle = 360 / 6;
        const arcAngle = degToRad(eachAngle - 5);
        const lineWidth = 10;

        context.lineWidth = lineWidth;
        const gradient = context.createLinearGradient(10, 30, 550, 250);
          gradient.addColorStop(0, 'red');
          gradient.addColorStop(0.25, 'yellow');
          gradient.addColorStop(0.5, 'red');
          gradient.addColorStop(0.75, 'yellow');
          gradient.addColorStop(1, 'red');

        // context.strokeStyle = 'rgba(255, 0, 0, 0.8)';
        context.strokeStyle = gradient;

        for (let i = 0; i < 6; i++) {
          context.translate(canvasSize / 2, canvasSize / 2);
          context.rotate(degToRad(eachAngle));
          context.translate(-canvasSize / 2, -canvasSize / 2);
          context.beginPath();
          context.arc(canvasSize / 2, canvasSize / 2, canvasSize / 2 - lineWidth / 2, 0, arcAngle);
          context.stroke();
        }
        
        return $canvas;
      });
      plane.position.z = -1.55;

      setDecoPlaneRotation(plane, 1);
      decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0.2);
      // decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );


      //top 기둥
      plane = new THREE.Mesh(
      new THREE.CylinderGeometry( 1.55, 1.55, .08, 32, 1, true ),
      new THREE.MeshBasicMaterial({ 
        color: 'rgba(255, 0, 0)', 
        opacity: '0.6',
        side: THREE.DoubleSide,
				transparent: true,
				depthTest: false,
      })
    );
    // scene.add(plane);
    plane.position.y = -1.95;
    decoTimeline.fromTo(plane.scale, { x: 0 }, { x: 1, duration: 1.5, ease: 'expo.inOut', onUpdate: onDecoPlaneTimelineUpdate, onUpdateParams: [plane] }, 0.2);
    decoTimeline.fromTo(plane.rotation, { x: degToRad(90), y: degToRad(0), }, { x: degToRad(0), y: degToRad(0), duration: 3, ease: 'expo.inOut', }, 0.1 );

    }

    function createDecoPlane (size, textureGenerator) {
      const plane = new THREE.Mesh(
        new THREE.PlaneGeometry(size, size),
        new THREE.MeshBasicMaterial({
          transparent: true,
          depthTest: false,
          map: new THREE.CanvasTexture(textureGenerator())
        })
      );
      plane.material.map.minFilter = THREE.NearestFilter;
      // plane.material.map.magFilter = THREE.NearestFilter;
      decoGroup.add(plane);
      return plane;
    }

    function onDecoPlaneTimelineUpdate (plane) {
      plane.scale.y = plane.scale.x;
    }

    function setDecoPlaneRotation (plane, durationBase = 2) {
      gsap.to(plane.rotation, { z: plane.rotation.z + (Math.random() * PI - PI_HALF), duration: Math.random() * durationBase + durationBase, ease: Back.easeInOut.config(5), onComplete: setDecoPlaneRotation, onCompleteParams: [plane, durationBase] });
    }

    function createCanvas (size) {
      const $canvas = document.createElement('canvas');
      $canvas.width = $canvas.height = size || canvasSize;
      return {
        $canvas,
        context: $canvas.getContext('2d')
      };
    }

    function onResize () {
      areaWidth = $visual.offsetWidth;
      areaHeight = $visual.offsetHeight;

      if (renderer) {
        const pixelRatio = Math.min(2, window.devicePixelRatio);

        camera.aspect = areaWidth / areaHeight;
        camera.updateProjectionMatrix();

        composer.setSize(areaWidth * pixelRatio, areaHeight * pixelRatio);
        bloomPass.uniforms.u_resolution.value.set(areaWidth * pixelRatio, areaHeight * pixelRatio);

        renderer.setSize(areaWidth, areaHeight);
        renderer.setPixelRatio(pixelRatio);
      }
    }

    let numRendered = 0;
    function animate (time, deltaTime) {
      stats && stats.update();
      control && control.update();

      composer.render(deltaTime);

      window._DEBUG && console.log('render', renderer.info.render.calls);
    }

    return { init };
  })();


  // print sample data
  const sampleUsers = [
    {
      "sid": "sid-100",
      "riskpoint": "20",
      "name": "홍지원",
      "deptNm": "사업부",
      "gridColor": "#F5F232"
    },
    {
      "sid": "sid-101",
      "riskpoint": "80",
      "name": "이수연",
      "deptNm": "영업부",
      "gridColor": "#F5F232"
    },
    {
      "sid": "sid-102",
      "riskpoint": "70",
      "name": "윤준원",
      "deptNm": "영업부",
      "gridColor": "#F5F232"
    },
    {
      "sid": "sid-103",
      "name": "김인사",
      "deptNm": "인사부"
    },
    {
      "sid": "sid-104",
      "name": "이개발",
      "deptNm": "개발부"
    },
    {
      "sid": "sid-105",
      "name": "박사업",
      "deptNm": "사업부"
    },
    {
      "sid": "sid-106",
      "name": "최인사",
      "deptNm": "인사부"
    },
    {
      "sid": "sid-107",
      "name": "정영업",
      "deptNm": "영업부"
    },
    {
      "sid": "sid-108",
      "name": "장사업",
      "deptNm": "사업부"
    },
    {
      "sid": "sid-109",
      "name": "박사업",
      "deptNm": "사업부"
    }
  ];

  const sampleData = { list: [] };
  sampleUsers.forEach((user) => {
    user.corpNm = '네이버시스템';
    user.riskpoint = user.riskpoint || Math.floor(Math.random() * 10) * 10;
    user.gridColor = user.gridColor || '#F5F232';
  });
  sampleUsers.forEach((user) => {
    const item = user;
    item.intimacyList = [];
    item.similarityList = [];

    ['intimacyList', 'similarityList'].forEach((listName) => {
      const sampleUsersClone = sampleUsers.slice();
      sampleUsersClone.splice(sampleUsers.indexOf(user), 1);

      const numList = Math.floor(Math.random() * 5);
      for (let i = 0; i < numList; i++) {
        const _user = { ...sampleUsersClone.splice(Math.floor(Math.random() * sampleUsersClone.length), 1)[0] };
        delete _user.intimacyList;
        delete _user.similarityList;
        item[listName].push(_user);
      }
    });

    sampleData.list.push(item);
  });
  // console.log(JSON.stringify(sampleData, null, '\t'));

  const monitorOptions = {
    speed: 1,
    delay: 15, // 최소 3,
    lightSpeed: 1,
    lightColor: '#fcf8e1', // 기본값 #fcf8e1
    onChangeActive: (data) => { console.log('슬라이드 가운데 위치 / 유저 정보 : ', data) },
    onClickActiveSlide: (data) => { console.log('슬라이드 클릭 / 유저 정보 : ', data) },
    onClickSimilarityList: (data) => { console.log('유사도 게시판 클릭 / 유저 정보 : ', data) },
    onClickIntimacyList: (data) => { console.log('친밀도 게시판 클릭 / 유저 정보 : ', data) },
  }

  const monitor3d = Monitor3d.init('#visual', sampleUsers, monitorOptions);
  </script>

</body>
</html>















